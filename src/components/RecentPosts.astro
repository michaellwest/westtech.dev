---
import { getCollection } from "astro:content";

const all = await getCollection("posts", ({ data }) => !data.draft);

// Sort by updated date if present, otherwise created â€” most recent first
const recent = all
  .sort((a, b) => {
    const aDate = a.data.updated ?? a.data.created;
    const bDate = b.data.updated ?? b.data.created;
    return bDate.getTime() - aDate.getTime();
  })
  .slice(0, 5);

function formatDate(d: Date) {
  return d.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" });
}
---

<div>
  <h2 class="text-xs font-semibold uppercase tracking-widest text-zinc-400 dark:text-zinc-500 mb-3">
    Recently Updated
  </h2>
  <ul class="space-y-3">
    {
      recent.map((post) => {
        const displayDate = post.data.updated ?? post.data.created;
        const isUpdated = !!post.data.updated;
        return (
          <li>
            <a
              href={`/${post.id}`}
              class="block text-sm text-zinc-700 dark:text-zinc-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors leading-snug"
            >
              {post.data.title}
            </a>
            <p class="text-xs text-zinc-400 dark:text-zinc-500 mt-0.5">
              {isUpdated ? "Updated " : ""}{formatDate(displayDate)}
            </p>
          </li>
        );
      })
    }
  </ul>
</div>
