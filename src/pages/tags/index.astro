---
import { getCollection } from "astro:content";
import SiteLayout from "../../layouts/SiteLayout.astro";

const posts = await getCollection("posts", ({ data }) => !data.draft);

// Build tag â†’ count map
const tagMap = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags) {
    tagMap.set(tag, (tagMap.get(tag) ?? 0) + 1);
  }
}

const tags = [...tagMap.entries()].sort((a, b) => a[0].localeCompare(b[0]));
---

<SiteLayout title="Tags" description="Browse all tags on westtech.dev">
  <h1 class="text-2xl font-bold mb-8 text-zinc-900 dark:text-zinc-50">Tags</h1>

  {
    tags.length === 0 ? (
      <p class="text-zinc-500 dark:text-zinc-400">No tags yet.</p>
    ) : (
      <ul class="flex flex-wrap gap-3">
        {tags.map(([tag, count]) => (
          <li>
            <a
              href={`/tags/${tag.toLowerCase().replace(/\s+/g, "-")}`}
              class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:hover:text-blue-400 transition-colors text-sm font-medium"
            >
              {tag}
              <span class="text-xs text-zinc-400 dark:text-zinc-500">{count}</span>
            </a>
          </li>
        ))}
      </ul>
    )
  }
</SiteLayout>
